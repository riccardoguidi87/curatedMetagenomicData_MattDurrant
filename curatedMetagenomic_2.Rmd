---
title: "Metadata Exploration for curatedMetagenomic Project"
output: html_notebook
---
# GuptaA_2019
What is the status of this study's metadata in the table already provided?
```{r message=FALSE, warning=FALSE}
# upload curatedMetadata 
df <- read_tsv("raw-data/curatedMetagenomicData.tsv")

#vilsualize tables with the studies of interest (CRC with Ctrs)
studiesCRCwithCtr <- read_csv("curated-data/studiesCRCwithCtr.csv")
studiesCRCwithCtr
```
What is the status of this study's metadata in the table already provided?
```{r message=FALSE, warning=FALSE}
df %>%
  filter(study_name == "YachidaS_2019")
```
There is some data but not too much. Does the original publication have metadata?
FengQ_2015	CRC	46 --> found 		
GuptaA_2019	CRC	30 --> not found
HanniganGD_2017	CRC	27 -->not found
ThomasAM_2018a	CRC	29 
ThomasAM_2018b	CRC	32
ThomasAM_2019_c	CRC	40	--> not found	
VogtmannE_2016	CRC	52		--> not found	
WirbelJ_2018	CRC	60		--> this is a meta-analysis
YachidaS_2019	CRC	258		--> possible found
YuJ_2015	CRC	75	

# YachidaS_2019
Open file
```{r}
# I confirmed there is lots of data in the published dataset
# curate the table ready for merge

## First Table comes from Sheet 4
YachidaS_2019_SupplData2_1 <- read_excel("raw-data/YachidaS_2019_PMID31171880/41591_2019_458_MOESM3_ESM.xlsx",sheet = 4,skip = 2)

newHeader <- str_replace(string = names(YachidaS_2019_SupplData2_1),pattern = "[[:space:]]",replacement = "")
names(YachidaS_2019_SupplData2_1) <- newHeader

YachidaS_2019_SupplData2_2 <- YachidaS_2019_SupplData2_1 %>%
  mutate(across(names(YachidaS_2019_SupplData2_1[,2:3]), as.factor)) %>%
  mutate(across(names(YachidaS_2019_SupplData2_1[,5]), as.factor)) %>%
  mutate(across(names(YachidaS_2019_SupplData2_1[,6:8]), as.numeric)) %>%
  mutate(across(names(YachidaS_2019_SupplData2_1[,9]), as.factor))

# I have now a well formatted table

YachidaS_2019_SupplData2_2

## Second Table comes from Sheet 5

YachidaS_2019_SupplData3_1 <- read_excel("raw-data/YachidaS_2019_PMID31171880/41591_2019_458_MOESM3_ESM.xlsx",sheet = 5, skip = 2)

newHeader <- str_replace(string = names(YachidaS_2019_SupplData3_1),pattern = "[[:space:]]",replacement = "")
names(YachidaS_2019_SupplData3_1) <- newHeader

YachidaS_2019_SupplData3_2 <- YachidaS_2019_SupplData3_1 %>%
  mutate(across(names(YachidaS_2019_SupplData2_1[,1]), as.character)) %>%
  mutate(across(names(YachidaS_2019_SupplData3_1[,2:3]), as.factor)) %>%
  mutate(across(names(YachidaS_2019_SupplData3_1[,5]), as.factor)) %>%
  mutate(across(names(YachidaS_2019_SupplData3_1[,6:8]), as.numeric)) %>%
  mutate(across(names(YachidaS_2019_SupplData3_1[,9]), as.factor))

# I have now a well formatted table

YachidaS_2019_SupplData3_2
```
join tables

```{r}
YachidaS_2019_SupplData1_1 <- bind_rows(YachidaS_2019_SupplData2_2,YachidaS_2019_SupplData3_2)
YachidaS_2019_SupplData1_1
```
This study also comes with metabolomic data per patient!

```{r}
# I confirmed there is lots of data in the published dataset
# curate a table

## This is a Metabolomic Table
YachidaS_2019_SupplData13_1 <- read_excel("raw-data/YachidaS_2019_PMID31171880/41591_2019_458_MOESM3_ESM.xlsx",sheet = 18,skip = 3)
names(YachidaS_2019_SupplData13_1)[1] <- "metabolite" 

YachidaS_2019_SupplData13_2 <- YachidaS_2019_SupplData13_1 %>%
  pivot_longer(cols = !c("metabolite"), names_to = "Subject_ID") %>%
  select(Subject_ID, everything())

# I have now a well formatted table

YachidaS_2019_SupplData13_2
```
Merge metabolomic into clinical annotation. 

```{r}
YachidaS_2019_SupplData1_2 <- inner_join(YachidaS_2019_SupplData1_1,YachidaS_2019_SupplData13_2,by="Subject_ID")
YachidaS_2019_SupplData1_2
```

Visualization of relevant metabolites (higher mean value than 10)

```{r}
# Distribution of matabolites
relevantMetab <- YachidaS_2019_SupplData1_2 %>%
  select(metabolite,value) %>%
  group_by(metabolite) %>%
  summarise(mean = mean(value)) %>%
  filter(mean >= 10) %>% 
  pivot_wider(names_from = metabolite, values_from = mean) %>% names()
  
p1 <- YachidaS_2019_SupplData1_2 %>%
  filter(metabolite %in% relevantMetab) %>%
  mutate(valueLOG10 = log10(value)) %>%
  
  ggplot(aes(x=metabolite,y=valueLOG10)) +
  geom_boxplot(outlier.shape = NA)

p1
```
Do any of these metabolites correlate with tumor Stage?

```{r message=FALSE, warning=FALSE}
# Does any of these metabolites correlate with tumour stage?
p2 <- YachidaS_2019_SupplData1_2 %>%
  filter(metabolite %in% relevantMetab) %>%
  mutate(valueLOG10 = log10(value)) %>%
  filter(metabolite == "C06423_Octanoate") %>%

  ggplot(aes(x=Stage,y=valueLOG10)) +
  geom_violin() +
  geom_jitter(size = 1)

p2
```


